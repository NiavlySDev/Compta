<UserControl x:Class="BlackWoodsCompta.WPF.Views.PurchasePricesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:helpers="clr-namespace:BlackWoodsCompta.WPF.Helpers"
             Background="#1E1E1E">
    
    <UserControl.Resources>
        <helpers:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <!-- Styles pour les dialogues -->
        <Style x:Key="DarkTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#3E3E42"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>
        
        <Style x:Key="DarkButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#673AB7"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
    </UserControl.Resources>
    
    <Grid>
        <!-- Dialog Overlay -->
        <Grid Visibility="{Binding IsAddEditDialogOpen, Converter={StaticResource BooleanToVisibilityConverter}}"
              Background="#CC000000"
              Panel.ZIndex="1000">
            <Border Width="500" Background="#2D2D30" Padding="30" CornerRadius="10" 
                    BorderBrush="#673AB7" BorderThickness="2"
                    HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel>
                    <TextBlock Text="ðŸ’° Prix d'Achat" FontSize="24" FontWeight="Bold" Foreground="White" Margin="0,0,0,20"/>

                    <TextBlock Text="Nom du produit" Foreground="#AAAAAA" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding NewProductName, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource DarkTextBoxStyle}" Margin="0,0,0,15"/>

                    <Grid Margin="0,0,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="CatÃ©gorie" Foreground="#AAAAAA" Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding Categories}" 
                                     SelectedItem="{Binding NewCategory, Mode=TwoWay}" 
                                     IsEditable="False"
                                     Background="#2D2D30" Foreground="White" BorderBrush="#3E3E42" BorderThickness="1" Padding="10" FontSize="14"/>
                        </StackPanel>
                    </Grid>

                    <TextBlock Text="Prix unitaire ($)" Foreground="#AAAAAA" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding NewUnitPrice, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource DarkTextBoxStyle}" Margin="0,0,0,15"/>

                    <TextBlock Text="Fournisseur" Foreground="#AAAAAA" Margin="0,0,0,5"/>
                    <ComboBox ItemsSource="{Binding Suppliers}" 
                             SelectedValue="{Binding NewSupplier, Mode=TwoWay}" 
                             SelectedValuePath="Name"
                             DisplayMemberPath="Name"
                             IsEditable="True"
                             Background="#2D2D30" Foreground="White" BorderBrush="#3E3E42" BorderThickness="1" Padding="10" FontSize="14" Margin="0,0,0,20"/>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Annuler" Command="{Binding CancelDialogCommand}" Background="Transparent" Foreground="White" BorderBrush="White" BorderThickness="1" Padding="15,8" Margin="0,0,15,0"/>
                        <Button Content="Enregistrer" Command="{Binding SaveItemCommand}" Style="{StaticResource DarkButtonStyle}"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Main Content -->
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                <TextBlock Text="ðŸ’°" FontSize="36" Margin="0,0,15,0"/>
                <StackPanel VerticalAlignment="Center">
                    <TextBlock Text="Prix d'Achat" FontSize="28" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="Gestion des prix d'achat des matiÃ¨res premiÃ¨res" FontSize="14" Foreground="#AAAAAA"/>
                </StackPanel>
            </StackPanel>

            <!-- Filters and Controls -->
            <Border Grid.Row="1" Background="#2D2D2D" CornerRadius="10" Padding="20" Margin="0,0,0,20">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="200"/>
                        <ColumnDefinition Width="200"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock Text="ðŸ”" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center"/>
                        <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                                 Width="250" Height="35" Background="#4D4D4D" Foreground="White"
                                 BorderBrush="#673AB7" Padding="10" VerticalContentAlignment="Center"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" Margin="20,0,0,0">
                        <TextBlock Text="CatÃ©gorie" Foreground="White" FontSize="12" Margin="0,0,0,5"/>
                        <ComboBox ItemsSource="{Binding Categories}" 
                                 SelectedItem="{Binding FilterCategory}" 
                                 Background="#4D4D4D" Foreground="White" BorderBrush="#673AB7" Height="35"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" Margin="20,0,0,0">
                        <TextBlock Text="Fournisseur" Foreground="White" FontSize="12" Margin="0,0,0,5"/>
                        <ComboBox ItemsSource="{Binding Suppliers}" 
                                 SelectedItem="{Binding FilterSupplier}" 
                                 Background="#4D4D4D" Foreground="White" BorderBrush="#673AB7" Height="35"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="4" Orientation="Horizontal">
                        <Button Content="ðŸ”„ Actualiser" Command="{Binding LoadPurchasePricesCommand}"
                                Background="#673AB7" Foreground="White" BorderThickness="0" 
                                Padding="15,8" Margin="0,0,10,0"/>
                        <Button Content="âž• Ajouter" Command="{Binding OpenAddDialogCommand}"
                                Background="#4CAF50" Foreground="White" BorderThickness="0" 
                                Padding="15,8"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Purchase Prices DataGrid -->
            <DataGrid Grid.Row="2" 
                      ItemsSource="{Binding PurchasePrices}" 
                      SelectedItem="{Binding SelectedItem}"
                      AutoGenerateColumns="False" 
                      CanUserAddRows="False" 
                      CanUserDeleteRows="False" 
                      IsReadOnly="True" 
                      SelectionMode="Single"
                      Background="#1E1E1E"
                      Foreground="White"
                      GridLinesVisibility="Horizontal"
                      HorizontalGridLinesBrush="#673AB7"
                      RowBackground="#2D2D2D"
                      AlternatingRowBackground="#363636"
                      BorderBrush="#673AB7"
                      BorderThickness="2"
                      Margin="0,0,0,0">
                
                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#673AB7"/>
                        <Setter Property="Foreground" Value="White"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="Padding" Value="12,10"/>
                        <Setter Property="BorderBrush" Value="#5E35B1"/>
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>

                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Height" Value="50"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#673AB7"/>
                                <Setter Property="Opacity" Value="0.8"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#9C27B0"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>

                <DataGrid.CellStyle>
                    <Style TargetType="DataGridCell">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="12,8"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                    </Style>
                </DataGrid.CellStyle>
                
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ðŸ·ï¸ Produit" 
                                        Binding="{Binding ProductName}" 
                                        Width="200"
                                        FontWeight="SemiBold"/>
                    
                    <DataGridTextColumn Header="ðŸ“‚ CatÃ©gorie" 
                                        Binding="{Binding Category}" 
                                        Width="150"/>
                    
                    <DataGridTextColumn Header="ðŸ’° Prix" 
                                        Binding="{Binding UnitPrice, StringFormat=C}" 
                                        Width="120">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="FontSize" Value="16"/>
                                <Setter Property="Foreground" Value="#4CAF50"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="ðŸª Fournisseur" 
                                        Binding="{Binding Supplier}" 
                                        Width="180"/>
                    
                    <DataGridTextColumn Header="ðŸ“… Maj" 
                                        Binding="{Binding LastUpdated, StringFormat='dd/MM/yyyy'}" 
                                        Width="100"/>
                    
                    <DataGridTemplateColumn Header="âš¡ Actions" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Content="âœï¸" Width="30" Height="30" Margin="2"
                                            Background="#673AB7" Foreground="White" BorderThickness="0"
                                            Command="{Binding DataContext.OpenEditDialogCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            ToolTip="Modifier"/>
                                    <Button Content="ðŸ—‘ï¸" Width="30" Height="30" Margin="2"
                                            Background="#D32F2F" Foreground="White" BorderThickness="0"
                                            Command="{Binding DataContext.DeleteItemCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            ToolTip="Supprimer"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>

        <!-- Loading Overlay -->
        <Grid Background="#80000000" 
              Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Border Background="#2D2D2D" CornerRadius="10" Padding="30" HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="â³" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                    <TextBlock Text="Chargement des prix d'achat..." FontSize="16" Foreground="White" HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>