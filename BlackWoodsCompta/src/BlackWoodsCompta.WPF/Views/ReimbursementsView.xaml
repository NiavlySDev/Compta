<UserControl x:Class="BlackWoodsCompta.WPF.Views.ReimbursementsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewmodels="clr-namespace:BlackWoodsCompta.WPF.ViewModels"
             d:DataContext="{d:DesignInstance Type=viewmodels:ReimbursementsViewModel}"
             mc:Ignorable="d"
             Background="#1E1E1E">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Grid.Row="0" 
                   Text="Gestion des Remboursements" 
                   FontSize="24" 
                   FontWeight="Bold" 
                   Foreground="White" 
                   Margin="16"/>

        <!-- Summary Cards -->
        <Grid Grid.Row="1" Margin="16,0,16,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Total Pending -->
            <Border Grid.Column="0" 
                    Background="#FF9800" 
                    CornerRadius="8" 
                    Padding="16" 
                    Margin="0,0,8,0">
                <StackPanel>
                    <TextBlock Text="ðŸ’° Total Ã  Rembourser" 
                               FontSize="14" 
                               FontWeight="Bold" 
                               Foreground="White" 
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding TotalPendingReimbursements, StringFormat=C2}" 
                               FontSize="20" 
                               FontWeight="Bold" 
                               Foreground="White" 
                               HorizontalAlignment="Center" 
                               Margin="0,8,0,0"/>
                </StackPanel>
            </Border>

            <!-- Count Active -->
            <Border Grid.Column="1" 
                    Background="#2196F3" 
                    CornerRadius="8" 
                    Padding="16" 
                    Margin="4,0">
                <StackPanel>
                    <TextBlock Text="ðŸ“‹ Remboursements Actifs" 
                               FontSize="14" 
                               FontWeight="Bold" 
                               Foreground="White" 
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding Reimbursements.Count}" 
                               FontSize="20" 
                               FontWeight="Bold" 
                               Foreground="White" 
                               HorizontalAlignment="Center" 
                               Margin="0,8,0,0"/>
                </StackPanel>
            </Border>

            <!-- Anne Holmes Special -->
            <Border Grid.Column="2" 
                    Background="#F44336" 
                    CornerRadius="8" 
                    Padding="16" 
                    Margin="8,0,0,0">
                <StackPanel>
                    <TextBlock Text="âš ï¸ Anne Holmes (Urgent)" 
                               FontSize="14" 
                               FontWeight="Bold" 
                               Foreground="White" 
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="$17,000.00" 
                               FontSize="20" 
                               FontWeight="Bold" 
                               Foreground="White" 
                               HorizontalAlignment="Center" 
                               Margin="0,8,0,0"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Filters and Controls -->
        <Border Grid.Row="2" 
                Background="#2D2D2D" 
                CornerRadius="8" 
                Margin="16,0,16,16" 
                Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Filter by Status -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="ðŸ“Š Filtrer par statut:" Foreground="White" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox SelectedItem="{Binding FilterStatus}" 
                              Width="150" 
                              Height="35"
                              Background="#2D2D2D"
                              Foreground="White"
                              BorderBrush="#673AB7">
                        <ComboBoxItem Content="Tous"/>
                        <ComboBoxItem Content="En_Attente"/>
                        <ComboBoxItem Content="Approuve"/>
                        <ComboBoxItem Content="Paye"/>
                        <ComboBoxItem Content="Rejete"/>
                    </ComboBox>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" 
                           Orientation="Horizontal" 
                           VerticalAlignment="Center" 
                           Margin="16,0">
                    <Button Content="âœ… Approuver" 
                            Command="{Binding ApproveReimbursementCommand}" 
                            Width="100"
                            Background="#4CAF50"
                            Foreground="White"
                            Padding="8"
                            Margin="4"/>
                    <Button Content="ðŸ’³ Payer" 
                            Command="{Binding PayReimbursementCommand}" 
                            Width="100"
                            Background="#2196F3"
                            Foreground="White"
                            Padding="8"
                            Margin="4"/>
                    <Button Content="âŒ Rejeter" 
                            Command="{Binding RejectReimbursementCommand}" 
                            Width="100"
                            Background="#F44336"
                            Foreground="White"
                            Padding="8"
                            Margin="4"/>
                </StackPanel>

                <!-- Loading Indicator -->
                <StackPanel Grid.Column="2" 
                           VerticalAlignment="Center" 
                           Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <ProgressBar IsIndeterminate="True" Width="100" Height="20"/>
                    <TextBlock Text="Chargement..." Foreground="White" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Reimbursements Data Grid -->
        <DataGrid Grid.Row="3" 
                  ItemsSource="{Binding Reimbursements}" 
                  SelectedItem="{Binding SelectedReimbursement}"
                  AutoGenerateColumns="False" 
                  CanUserAddRows="False" 
                  CanUserDeleteRows="False" 
                  IsReadOnly="True" 
                  SelectionMode="Single"
                  Background="#1E1E1E"
                  Foreground="White"
                  GridLinesVisibility="Horizontal"
                  HorizontalGridLinesBrush="#333333"
                  RowBackground="#2D2D2D"
                  AlternatingRowBackground="#363636"
                  BorderBrush="#673AB7"
                  Margin="16,0,16,16">
            
            <DataGrid.ColumnHeaderStyle>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="#673AB7"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                    <Setter Property="Padding" Value="8"/>
                </Style>
            </DataGrid.ColumnHeaderStyle>

            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Setter Property="Background" Value="Transparent"/>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#673AB7"/>
                            <Setter Property="Opacity" Value="0.7"/>
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="#9C27B0"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>

            <DataGrid.CellStyle>
                <Style TargetType="DataGridCell">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="Padding" Value="8"/>
                </Style>
            </DataGrid.CellStyle>
            
            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" 
                                    Binding="{Binding Id}" 
                                    Width="50"/>
                
                <DataGridTextColumn Header="EmployÃ©" 
                                    Binding="{Binding Employee.Name}" 
                                    Width="150"/>
                
                <DataGridTextColumn Header="Montant" 
                                    Binding="{Binding Amount, StringFormat=C2}" 
                                    Width="100"/>
                
                <DataGridTextColumn Header="Date Demande" 
                                    Binding="{Binding RequestDate, StringFormat='dd/MM/yyyy HH:mm'}" 
                                    Width="130"/>
                
                <DataGridTextColumn Header="Statut" 
                                    Binding="{Binding Status}" 
                                    Width="100"/>
                
                <DataGridTextColumn Header="Date Approbation" 
                                    Binding="{Binding ApprovedDate, StringFormat='dd/MM/yyyy HH:mm'}" 
                                    Width="130"/>
                
                <DataGridTextColumn Header="Description" 
                                    Binding="{Binding Description}" 
                                    Width="*"/>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</UserControl>